# Base Node.js image
FROM node:18-alpine

# Install FFmpeg and other dependencies
RUN apk add --no-cache ffmpeg

# Create app directory
WORKDIR /usr/src/app

# Copy package.json and package-lock.json
COPY package*.json ./

# Install dependencies
RUN npm ci --only=production

# Copy app source
COPY . .

# Create required directories
RUN mkdir -p temp output public/css public/js resources/elements

# Install a simple default cover image if it doesn't exist
RUN if [ ! -f resources/elements/DA1neverBlankmetaMetaData_Cover_01.jpg ]; then \
    echo "Creating placeholder cover image"; \
    echo "iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6RjkzODZDOTAyNDI0MTFFQUFFNzZCODUzNUNBRTkwOTkiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RjkzODZDOTEyNDI0MTFFQUFFNzZCODUzNUNBRTkwOTkiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpGOTM4NkM4RTI0MjQxMUVBQUU3NkI4NTM1Q0FFOTBBQSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpGOTM4NkM4RjI0MjQxMUVBQUU3NkI4NTM1Q0FFOTBBQSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PhoPefQAABJ3SURBVHja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